<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<!-- including ECharts file -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/4.2.1/echarts.min.js"></script>
</head>

<body>
	<!-- prepare a DOM container with width and height -->
	<form id="company-search">
		Company: <input type="text" id="company_name" value="Twenty-First Century Fox, Inc.">
		<input type="submit" value="Show">
	</form>
	<div id="main" style="width: 1000px;height:400px;"></div>

	<script type="text/javascript">



		function rebuildAnswerSectionForCompanyName(companyName) {

			// based on prepared DOM, initialize echarts instance
			var myChart = echarts.init(document.getElementById('main'));

			var oReq = new XMLHttpRequest();
			oReq.addEventListener("load", reqListener);
			oReq.open("GET", "https://wikirate.org/PayScale+CEO_to_Worker_pay+Answer.json");
			oReq.send();

			function reqListener() {
				var response = JSON.parse(this.responseText)
				console.log(response);
				createChart1(response.items); 
				createChart2(response.items); 
			}


			function createChart2(items) {
				// alert(companyName); 
				const dataForSelectedCompany = items
					.filter(item => item.company === companyName)[0];
				console.log(dataForSelectedCompany);

				if(dataForSelectedCompany) {
					const metricValue = dataForSelectedCompany.value;
					alert(`The company ${companyName} produced ${metricValue} tons of CO2 in 2017`);
				}
			}





			function createChart1(items) {
				var companies = items.map(item => item.company)
				var payscales = items.map(item => parseInt(item.value))

				chartPayscale(companies, payscales)
			}

			function chartPayscale(labels, values) {
				// specify chart configuration item and data
				var option = {
					tooltip: {
						trigger: 'axis'
					},
					xAxis: {
						data: labels
					},
					yAxis: {},
					series: [{
						type: 'bar',
						data: values
					}]
				};

				// use configuration item and data specified to show chart
				myChart.setOption(option);
			}




		}



		function processForm(e) {
			if (e.preventDefault) e.preventDefault();
			const companyName = document.getElementById("company_name").value;
			rebuildAnswerSectionForCompanyName(companyName);
		};


		const companySearchForm = document.getElementById('company-search');
		if (companySearchForm.attachEvent) {
			companySearchForm.attachEvent("submit", processForm);
		} else {
			companySearchForm.addEventListener("submit", processForm);
		}



		


	</script>
</body>

</html>